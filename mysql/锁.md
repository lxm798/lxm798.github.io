# 锁

## 锁分类
S锁:共享锁
X锁:互斥锁
IS锁:意向锁
IX锁:
表锁: 对整个表加锁

## innodb中的锁
innodb只有表锁和行锁
行锁是对索引加锁,如果没有命中索引会变成表锁,对页中的数据加锁时,首先读取页中的数据,构造位图,针对位图加锁
GAP LOCK: 对于非唯一键节点会锁住除了等值查询意外的节点,包括节点左边和右边的数据

## 死锁
innodb 通过wait for graph实现死锁检测

## 自增id选项
利用 AutoIncrement-lock性能问题
选项auto_inc_lock_mode 限制自增主键的锁定策略:
* 0: 事务结束时释放锁
* 1: 对于单个插入获取自增变量后释放锁,对于批量插入事务结束后释放锁
* 2: 无论是否批量都是在每次获取后立即释放
两个维度:
是否在事务结束后才释放
是否批量申请
是否在插入后立即释放:
