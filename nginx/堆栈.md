
## epoll初始化
```c
#0  ngx_epoll_init (cycle=0x6ec4d0, timer=0) at src/event/modules/ngx_epoll_module.c:324
#1  0x000000000042a602 in ngx_event_process_init (cycle=0x6ec4d0) at src/event/ngx_event.c:659
#2  0x0000000000432c56 in ngx_single_process_cycle (cycle=cycle@entry=0x6ec4d0) at src/os/unix/ngx_process_cycle.c:300
#3  0x000000000040ccd8 in main (argc=<optimized out>, argv=<optimized out>) at src/core/nginx.c:379
```

```c
#0  ngx_epoll_process_events (cycle=0x6ec4d0, timer=18446744073709551615, flags=1) at src/event/modules/ngx_epoll_module.c:785
#1  0x000000000042ab2f in ngx_process_events_and_timers (cycle=cycle@entry=0x6ec4d0) at src/event/ngx_event.c:242
#2  0x0000000000432c87 in ngx_single_process_cycle (cycle=cycle@entry=0x6ec4d0) at src/os/unix/ngx_process_cycle.c:310
#3  0x000000000040ccd8 in main (argc=<optimized out>, argv=<optimized out>) at src/core/nginx.c:379
```

### 新建连接
```c
(gdb) bt
#0  ngx_epoll_add_event (ev=0x710ce0, event=8193, flags=2147483648) at src/event/modules/ngx_epoll_module.c:580
#1  0x000000000042aba8 in ngx_handle_read_event (rev=rev@entry=0x710ce0, flags=flags@entry=0) at src/event/ngx_event.c:271
#2  0x000000000043f417 in ngx_http_init_connection (c=0x7ffff7f930f8) at src/http/ngx_http_request.c:366
#3  0x000000000042b6fa in ngx_event_accept (ev=0x710c80) at src/event/ngx_event_accept.c:308
#4  0x0000000000433ae3 in ngx_epoll_process_events (cycle=<optimized out>, timer=<optimized out>, flags=<optimized out>) at src/event/modules/ngx_epoll_module.c:902
#5  0x000000000042ab2f in ngx_process_events_and_timers (cycle=cycle@entry=0x6ec4d0) at src/event/ngx_event.c:242
#6  0x0000000000432c87 in ngx_single_process_cycle (cycle=cycle@entry=0x6ec4d0) at src/os/unix/ngx_process_cycle.c:310
#7  0x000000000040ccd8 in main (argc=<optimized out>, argv=<optimized out>) at src/core/nginx.c:379
```

### http 创建listener
```c
#0  ngx_http_init_listening (port=<optimized out>, cf=0x7fffffffd670) at src/http/ngx_http.c:1658
#1  ngx_http_optimize_servers (ports=<optimized out>, cmcf=<optimized out>, cf=<optimized out>) at src/http/ngx_http.c:1412
#2  ngx_http_block (cf=<optimized out>, cmd=<optimized out>, conf=<optimized out>) at src/http/ngx_http.c:333
#3  0x000000000042018a in ngx_conf_handler (last=1, cf=0x7fffffffd670) at src/core/ngx_conf_file.c:463
#4  ngx_conf_parse (cf=cf@entry=0x7fffffffd670, filename=filename@entry=0x6ec6e0) at src/core/ngx_conf_file.c:319
#5  0x000000000041d8eb in ngx_init_cycle (old_cycle=old_cycle@entry=0x7fffffffd830) at src/core/ngx_cycle.c:275
#6  0x000000000040ca97 in main (argc=<optimized out>, argv=<optimized out>) at src/core/nginx.c:291
```

### http 新链接处理
```c
#0  ngx_http_init_connection (c=0x7ffff7f930f8) at src/http/ngx_http_request.c:207
#1  0x000000000042b6fa in ngx_event_accept (ev=0x710c80) at src/event/ngx_event_accept.c:308
#2  0x0000000000433ae3 in ngx_epoll_process_events (cycle=<optimized out>, timer=<optimized out>, flags=<optimized out>) at src/event/modules/ngx_epoll_module.c:902
#3  0x000000000042ab2f in ngx_process_events_and_timers (cycle=cycle@entry=0x6ec4d0) at src/event/ngx_event.c:242
#4  0x0000000000432c87 in ngx_single_process_cycle (cycle=cycle@entry=0x6ec4d0) at src/os/unix/ngx_process_cycle.c:310
#5  0x000000000040ccd8 in main (argc=<optimized out>, argv=<optimized out>) at src/core/nginx.c:379
```

### http 连接数据接收
```c
#0  ngx_http_wait_request_handler (rev=0x710ce0) at src/http/ngx_http_request.c:375
#1  0x0000000000433ae3 in ngx_epoll_process_events (cycle=<optimized out>, timer=<optimized out>, flags=<optimized out>) at src/event/modules/ngx_epoll_module.c:902
#2  0x000000000042ab2f in ngx_process_events_and_timers (cycle=cycle@entry=0x6ec4d0) at src/event/ngx_event.c:242
#3  0x0000000000432c87 in ngx_single_process_cycle (cycle=cycle@entry=0x6ec4d0) at src/os/unix/ngx_process_cycle.c:310
#4  0x000000000040ccd8 in main (argc=<optimized out>, argv=<optimized out>) at src/core/nginx.c:379
```

### http 请求处理
```c
#0  ngx_http_process_request (r=r@entry=0x7049b0) at src/http/ngx_http_request.c:1880
#1  0x00000000004409e3 in ngx_http_process_request_headers (rev=rev@entry=0x710ce0) at src/http/ngx_http_request.c:1379
#2  0x0000000000440cc7 in ngx_http_process_request_line (rev=rev@entry=0x710ce0) at src/http/ngx_http_request.c:1050
#3  0x00000000004413eb in ngx_http_wait_request_handler (rev=0x710ce0) at src/http/ngx_http_request.c:499
#4  0x0000000000433ae3 in ngx_epoll_process_events (cycle=<optimized out>, timer=<optimized out>, flags=<optimized out>) at src/event/modules/ngx_epoll_module.c:902
#5  0x000000000042ab2f in ngx_process_events_and_timers (cycle=cycle@entry=0x6ec4d0) at src/event/ngx_event.c:242
#6  0x0000000000432c87 in ngx_single_process_cycle (cycle=cycle@entry=0x6ec4d0) at src/os/unix/ngx_process_cycle.c:310
#7  0x000000000040ccd8 in main (argc=<optimized out>, argv=<optimized out>) at src/core/nginx.c:379
```

### http 模块分发
```c
#0  ngx_http_mytest_handler (r=0x7039b0) at ./mytest/ngx_http_mytest_module.c:55
#1  0x000000000043bc5c in ngx_http_core_content_phase (r=0x7039b0, ph=<optimized out>) at src/http/ngx_http_core_module.c:1169
#2  0x0000000000436c43 in ngx_http_core_run_phases (r=r@entry=0x7039b0) at src/http/ngx_http_core_module.c:858
#3  0x0000000000436d52 in ngx_http_handler (r=r@entry=0x7039b0) at src/http/ngx_http_core_module.c:841
#4  0x000000000043e79c in ngx_http_process_request (r=r@entry=0x7039b0) at src/http/ngx_http_request.c:1954
#5  0x00000000004409d3 in ngx_http_process_request_headers (rev=rev@entry=0x70fce0) at src/http/ngx_http_request.c:1379
#6  0x0000000000440cb7 in ngx_http_process_request_line (rev=rev@entry=0x70fce0) at src/http/ngx_http_request.c:1050
#7  0x00000000004413db in ngx_http_wait_request_handler (rev=0x70fce0) at src/http/ngx_http_request.c:499
#8  0x0000000000433ad3 in ngx_epoll_process_events (cycle=<optimized out>, timer=<optimized out>, flags=<optimized out>) at src/event/modules/ngx_epoll_module.c:902
#9  0x000000000042ab1f in ngx_process_events_and_timers (cycle=cycle@entry=0x6eb4d0) at src/event/ngx_event.c:242
#10 0x0000000000432c77 in ngx_single_process_cycle (cycle=cycle@entry=0x6eb4d0) at src/os/unix/ngx_process_cycle.c:310
#11 0x000000000040ccc8 in main (argc=<optimized out>, argv=<optimized out>) at src/core/nginx.c:379
```

### http 设置请求处理配置
```c
#0  ngx_http_update_location_config (r=r@entry=0x7039b0) at src/http/ngx_http_core_module.c:1217
#1  0x000000000043b1e2 in ngx_http_core_find_config_phase (r=0x7039b0, ph=<optimized out>) at src/http/ngx_http_core_module.c:962
#2  0x0000000000436c43 in ngx_http_core_run_phases (r=r@entry=0x7039b0) at src/http/ngx_http_core_module.c:858
#3  0x0000000000436d52 in ngx_http_handler (r=r@entry=0x7039b0) at src/http/ngx_http_core_module.c:841
#4  0x000000000043e79c in ngx_http_process_request (r=r@entry=0x7039b0) at src/http/ngx_http_request.c:1954
#5  0x00000000004409d3 in ngx_http_process_request_headers (rev=rev@entry=0x70fce0) at src/http/ngx_http_request.c:1379
#6  0x0000000000440cb7 in ngx_http_process_request_line (rev=rev@entry=0x70fce0) at src/http/ngx_http_request.c:1050
#7  0x00000000004413db in ngx_http_wait_request_handler (rev=0x70fce0) at src/http/ngx_http_request.c:499
#8  0x0000000000433ad3 in ngx_epoll_process_events (cycle=<optimized out>, timer=<optimized out>, flags=<optimized out>) at src/event/modules/ngx_epoll_module.c:902
#9  0x000000000042ab1f in ngx_process_events_and_timers (cycle=cycle@entry=0x6eb4d0) at src/event/ngx_event.c:242
#10 0x0000000000432c77 in ngx_single_process_cycle (cycle=cycle@entry=0x6eb4d0) at src/os/unix/ngx_process_cycle.c:310
#11 0x000000000040ccc8 in main (argc=<optimized out>, argv=<optimized out>) at src/core/nginx.c:379
```


#### create_srv_conf调用时机
```c
#0  create_srv_conf (cf=0x7fffffffd650) at /home/ly/cooder/mytest/4/chapter4/ngx_http_mytest_module.c:241
#1  0x0000000000434f2e in ngx_http_block (cf=0x7fffffffd650, cmd=<optimized out>, conf=<optimized out>) at src/http/ngx_http.c:202
#2  0x000000000042020a in ngx_conf_handler (last=1, cf=0x7fffffffd650) at src/core/ngx_conf_file.c:463
#3  ngx_conf_parse (cf=cf@entry=0x7fffffffd650, filename=filename@entry=0x6ec6e0) at src/core/ngx_conf_file.c:319
#4  0x000000000041d96b in ngx_init_cycle (old_cycle=old_cycle@entry=0x7fffffffd810) at src/core/ngx_cycle.c:275
#5  0x000000000040cb17 in main (argc=<optimized out>, argv=<optimized out>) at src/core/nginx.c:291

#0  create_srv_conf (cf=0x7fffffffd650) at /home/ly/cooder/mytest/4/chapter4/ngx_http_mytest_module.c:241
#1  0x000000000043aa77 in ngx_http_core_server (cf=0x7fffffffd650, cmd=<optimized out>, dummy=<optimized out>) at src/http/ngx_http_core_module.c:2757
#2  0x000000000042020a in ngx_conf_handler (last=1, cf=0x7fffffffd650) at src/core/ngx_conf_file.c:463
#3  ngx_conf_parse (cf=cf@entry=0x7fffffffd650, filename=filename@entry=0x0) at src/core/ngx_conf_file.c:319
#4  0x0000000000435063 in ngx_http_block (cf=0x7fffffffd650, cmd=<optimized out>, conf=<optimized out>) at src/http/ngx_http.c:237
#5  0x000000000042020a in ngx_conf_handler (last=1, cf=0x7fffffffd650) at src/core/ngx_conf_file.c:463
#6  ngx_conf_parse (cf=cf@entry=0x7fffffffd650, filename=filename@entry=0x6ec6e0) at src/core/ngx_conf_file.c:319
#7  0x000000000041d96b in ngx_init_cycle (old_cycle=old_cycle@entry=0x7fffffffd810) at src/core/ngx_cycle.c:275
#8  0x000000000040cb17 in main (argc=<optimized out>, argv=<optimized out>) at src/core/nginx.c:291



```